<!DOCTYPE html>
<html>
<head>
    <title>Debug localStorage</title>
</head>
<body>
    <h2>localStorage Debug</h2>
    <button onclick="checkStorage()">Check localStorage</button>
    <button onclick="clearStorage()">Clear localStorage</button>
    <button onclick="testLogin()">Test Login</button>
    <button onclick="testDelete()">Test Delete</button>
    <div id="output"></div>

    <script>
        function log(message) {
            document.getElementById('output').innerHTML += '<p>' + message + '</p>';
        }

        function checkStorage() {
            document.getElementById('output').innerHTML = '';
            log('=== localStorage Contents ===');
            log('auth_token: ' + localStorage.getItem('auth_token'));
            log('user: ' + localStorage.getItem('user'));
            log('Total items: ' + localStorage.length);
        }

        function clearStorage() {
            localStorage.clear();
            log('localStorage cleared');
        }

        async function testLogin() {
            try {
                log('Testing login...');
                const response = await fetch('http://localhost:8000/api/auth/login.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ token: 'sheinhtutoo2008' })
                });
                
                const data = await response.json();
                log('Login response: ' + JSON.stringify(data));
                
                if (data.success) {
                    localStorage.setItem('auth_token', data.token);
                    localStorage.setItem('user', JSON.stringify(data.user));
                    log('Token stored in localStorage');
                }
            } catch (error) {
                log('Login error: ' + error.message);
            }
        }

        async function testDelete() {
            try {
                const token = localStorage.getItem('auth_token');
                if (!token) {
                    log('No token found in localStorage');
                    return;
                }

                log('Testing delete with token: ' + token.substring(0, 50) + '...');
                
                const response = await fetch('http://localhost:8000/api/posts/delete.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + token
                    },
                    body: JSON.stringify({ id: 999 }) // Non-existent ID
                });
                
                const data = await response.json();
                log('Delete response: ' + JSON.stringify(data));
            } catch (error) {
                log('Delete error: ' + error.message);
            }
        }
    </script>
</body>
</html>
